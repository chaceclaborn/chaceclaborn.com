<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Raeha's Personal Tab - Chace Claborn</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../css/style.css" />
    <link rel="stylesheet" href="../css/navigation.css" />
    <link rel="stylesheet" href="../css/tier-styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
      /* Raeha's Page Styles */
      .raeha-container {
        max-width: 1200px;
        margin: 100px auto 40px;
        padding: 0 20px;
      }

      .welcome-section {
        /* Changed from purple gradient to match site theme */
        background: linear-gradient(135deg, #617140 0%, #4a5a30 100%);
        color: white;
        padding: 40px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 40px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .welcome-section h1 {
        font-size: 2.5rem;
        margin-bottom: 15px;
        color: white;
      }

      .welcome-section p {
        color: rgba(255, 255, 255, 0.95);
        font-size: 1.1rem;
      }

      .content-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 30px;
        margin-bottom: 40px;
      }

      .content-card {
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .content-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      }

      .content-card h2 {
        color: #617140;
        margin-bottom: 15px;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .content-card i {
        font-size: 1.5rem;
        color: #7a8a5a;
      }

      .customization-form {
        background: #f9fafb;
        padding: 20px;
        border-radius: 10px;
        margin-top: 20px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #374151;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s;
        box-sizing: border-box;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #617140;
      }

      .submit-btn {
        background: linear-gradient(135deg, #617140 0%, #4a5a30 100%);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(97, 113, 64, 0.3);
      }

      .feature-list {
        list-style: none;
        padding: 0;
      }

      .feature-list li {
        padding: 10px 0;
        display: flex;
        align-items: center;
        gap: 10px;
        border-bottom: 1px solid #e5e7eb;
      }

      .feature-list li:last-child {
        border-bottom: none;
      }

      .feature-list i {
        color: #10b981;
      }

      .future-features {
        background: #f9fafb;
        padding: 40px;
        border-radius: 15px;
        margin-bottom: 40px;
      }

      .future-features h2 {
        color: #617140;
        margin-bottom: 20px;
      }

      .future-features ul {
        list-style: none;
        padding: 0;
      }

      .future-features li {
        padding: 10px 0;
        position: relative;
        padding-left: 25px;
      }

      .future-features li::before {
        content: 'âœ¨';
        position: absolute;
        left: 0;
      }

      .loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: linear-gradient(135deg, #617140 0%, #4a5a30 100%);
        color: white;
      }

      .spinner {
        font-size: 3rem;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      .special-message {
        background: #fef3c7;
        padding: 20px;
        border-radius: 10px;
        margin-top: 15px;
      }

      .special-message p {
        color: #92400e;
        font-style: italic;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loading" class="loading">
      <i class="fas fa-spinner spinner"></i>
      <p>Checking access...</p>
    </div>

    <!-- Main Content (hidden until authentication) -->
    <div id="raeha-content" style="display: none">
      <!-- Header - Fixed Structure -->
      <header class="site-header">
        <div class="header-container">
          <div class="logo">
            <span class="logo-text">chaceclaborn.com</span>
          </div>

          <div class="nav-wrapper">
            <!-- Navigation will be injected here -->
            <nav class="main-nav" id="mainNav"></nav>

            <!-- User Info -->
            <div class="user-info" id="user-info" style="display: none">
              <img class="user-avatar" id="user-photo" src="" alt="User Avatar" />
              <span id="user-name" style="display: none"></span>
              <span id="user-email" style="display: none"></span>
              <a href="#" class="btn-modern sign-out-btn" id="logout-btn">Sign Out</a>
            </div>

            <!-- Sign In Button -->
            <a href="#" class="btn-modern" id="login-btn">Sign In</a>

            <!-- Mobile Menu Button -->
            <button class="mobile-menu-btn" id="mobileMenuBtn">
              <span></span>
              <span></span>
              <span></span>
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="raeha-container">
        <!-- Welcome Section with Site Theme Colors -->
        <section class="welcome-section">
          <h1>Welcome to Your Custom Tab, Raeha!</h1>
          <p>This is your personal space to request customizations and features for the website.</p>
        </section>

        <!-- Content Grid -->
        <div class="content-grid">
          <!-- Customization Request Card -->
          <div class="content-card">
            <h2><i class="fas fa-paint-brush"></i> Request Customizations</h2>
            <p>Want something changed or added? Let me know what you'd like to see!</p>
            <div class="customization-form">
              <form id="customization-form">
                <div class="form-group">
                  <label for="request-type">Type of Request</label>
                  <select id="request-type" name="request-type" required>
                    <option value="">Select a type...</option>
                    <option value="design">Design Change</option>
                    <option value="content">Content Update</option>
                    <option value="feature">New Feature</option>
                    <option value="photo">Photo/Media</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="request-details">Details</label>
                  <textarea id="request-details" name="request-details" rows="4" 
                    placeholder="Describe what you'd like..." required></textarea>
                </div>
                <button type="submit" class="submit-btn">
                  <i class="fas fa-paper-plane"></i> Send Request
                </button>
              </form>
            </div>
          </div>

          <!-- Current Features Card -->
          <div class="content-card">
            <h2><i class="fas fa-star"></i> Your Current Features</h2>
            <ul class="feature-list">
              <li><i class="fas fa-check-circle"></i> Custom tab access</li>
              <li><i class="fas fa-check-circle"></i> Priority feature requests</li>
              <li><i class="fas fa-check-circle"></i> Custom content sections</li>
              <li><i class="fas fa-check-circle"></i> Photo galleries (coming soon)</li>
              <li><i class="fas fa-check-circle"></i> Private messaging (coming soon)</li>
            </ul>
          </div>

          <!-- Quick Actions Card -->
          <div class="content-card">
            <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
            <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
              <button class="submit-btn" onclick="alert('Feature coming soon!')">
                <i class="fas fa-images"></i> Upload Photos
              </button>
              <button class="submit-btn" onclick="alert('Feature coming soon!')">
                <i class="fas fa-palette"></i> Change Theme
              </button>
              <button class="submit-btn" onclick="alert('Feature coming soon!')">
                <i class="fas fa-envelope"></i> Send Message
              </button>
            </div>
          </div>

        </div>

        <!-- Future Features -->
        <section class="future-features">
          <h2><i class="fas fa-sparkles"></i> Coming Soon</h2>
          <ul>
            <li>...</li>
            
          </ul>
          <p>
            Have an idea for something you'd like to see here? 
            Use the request form above to let me know!
            I'll implement them as soon as possible and they'll appear here in your personal tab.
          </p>
        </section>
      </main>

      <!-- Footer -->
      <footer class="site-footer">
        <div class="footer-content">
          <p>&copy; 2025 Chace Claborn. All rights reserved.</p>
        </div>
      </footer>
    </div>

    <!-- Scripts in Correct Order -->
    <!-- Firebase Core FIRST -->
    <script type="module" src="../js/firebase/config.js"></script>
    <script type="module" src="../js/firebase/auth-service.js"></script>
    <script type="module" src="../js/firebase/auth-tiers.js"></script>
    
    <!-- Auth Init SECOND -->
    <script type="module" src="../js/auth-init.js"></script>
    
    <!-- Navigation Component THIRD -->
    <script type="module" src="../js/components/navigation.js"></script>

    <!-- Page-Specific Protection and Form Handler -->
    <script type="module">
      import { auth, db } from "../js/firebase/config.js";
      import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
      import { getUserTier, TIERS } from "../js/firebase/auth-tiers.js";
      import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

      // Wait for DOM to be ready
      document.addEventListener('DOMContentLoaded', () => {
        // Protect the page - Allow admin OR girlfriend tier
        onAuthStateChanged(auth, async (user) => {
          const loading = document.getElementById("loading");
          const content = document.getElementById("raeha-content");

          if (user) {
            const userTier = await getUserTier();
            // Allow access if user is girlfriend tier OR admin
            const hasAccess = userTier === TIERS.GIRLFRIEND || userTier === TIERS.ADMIN;
            
            if (hasAccess) {
              loading.style.display = "none";
              content.style.display = "block";
            } else {
              // Redirect if no access
              window.location.href = "../index.html?error=access-denied";
            }
          } else {
            // Redirect to home if not logged in
            window.location.href = "../index.html?action=signin";
          }
        });

        // Handle customization form
        const form = document.getElementById('customization-form');
        if (form) {
          form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const type = document.getElementById('request-type').value;
            const details = document.getElementById('request-details').value;
            
            if (!type || !details) {
              alert('Please fill in all fields');
              return;
            }
            
            try {
              // Save to Firestore
              const requestData = {
                type: type,
                details: details,
                email: auth.currentUser?.email || 'anonymous',
                displayName: auth.currentUser?.displayName || 'Anonymous',
                status: 'pending',
                createdAt: serverTimestamp(),
                userId: auth.currentUser?.uid || null
              };
              
              await addDoc(collection(db, 'customization_requests'), requestData);
              
              alert(`Request submitted!\n\nType: ${type}\nDetails: ${details}\n\nChace will implement this soon!`);
              
              // Clear form
              e.target.reset();
            } catch (error) {
              console.error('Error submitting request:', error);
              alert('Error submitting request. Please try again.');
            }
          });
        }
      });
    </script>
    
    <!-- Optional: Raeha Customization Script -->
    <script type="module" src="../js/raeha-customization.js"></script>
    
    <!-- Optional: Feedback Widget -->
    <script type="module" src="../js/firebase/feedback-service.js"></script>
  </body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Descent</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      overflow: hidden;
      background: #0a0a0f;
      font-family: 'Georgia', serif;
      color: #e0e0e0;
    }

    .tunnel-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      perspective: 1200px;
      perspective-origin: 50% 50%;
    }

    .layer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform-style: preserve-3d;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(ellipse at center, rgba(15, 15, 25, 0.95) 0%, rgba(5, 5, 10, 0.98) 100%);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: opacity 0.5s ease;
    }

    .layer-content {
      text-align: center;
      opacity: 0;
      transition: opacity 0.8s ease;
      padding: 60px;
      max-width: 90%;
    }

    .layer.active .layer-content {
      opacity: 1;
    }

    .layer h2 {
      font-size: 2.5rem;
      margin-bottom: 25px;
      font-weight: 300;
      letter-spacing: 8px;
      text-transform: uppercase;
    }

    .layer p {
      font-size: 1.15rem;
      line-height: 2;
      opacity: 0.8;
      max-width: 500px;
      margin: 0 auto;
    }

    .layer .detail {
      margin-top: 30px;
      font-size: 0.85rem;
      opacity: 0.4;
      font-style: italic;
    }

    /* Layer-specific colors */
    .layer:nth-child(1) { --glow: rgba(255, 255, 255, 0.1); }
    .layer:nth-child(2) { --glow: rgba(200, 200, 255, 0.1); }
    .layer:nth-child(3) { --glow: rgba(180, 180, 255, 0.1); }
    .layer:nth-child(4) { --glow: rgba(160, 140, 255, 0.1); }
    .layer:nth-child(5) { --glow: rgba(140, 100, 255, 0.12); }
    .layer:nth-child(6) { --glow: rgba(120, 60, 255, 0.15); }
    .layer:nth-child(7) { --glow: rgba(255, 50, 100, 0.15); }

    .layer {
      box-shadow: 0 0 100px var(--glow), inset 0 0 80px rgba(0, 0, 0, 0.8);
    }

    .depth-indicator {
      position: fixed;
      right: 30px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1000;
    }

    .depth-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.4s ease;
      cursor: pointer;
    }

    .depth-dot.active {
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
      transform: scale(1.4);
    }

    .depth-dot.visited {
      background: rgba(255, 255, 255, 0.4);
    }

    .scroll-hint {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255, 255, 255, 0.3);
      font-size: 0.75rem;
      letter-spacing: 4px;
      text-transform: uppercase;
      z-index: 1000;
      transition: opacity 1s;
    }

    .scroll-hint.hidden {
      opacity: 0;
    }

    .vignette {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.9) 100%);
      pointer-events: none;
      z-index: 100;
    }

    .visit-indicator {
      position: fixed;
      top: 30px;
      left: 30px;
      font-size: 0.75rem;
      opacity: 0.3;
      z-index: 1000;
      letter-spacing: 2px;
    }

    .warning {
      position: fixed;
      bottom: 30px;
      left: 30px;
      font-size: 0.7rem;
      opacity: 0;
      z-index: 1000;
      color: rgba(255, 100, 100, 0.6);
      transition: opacity 2s;
      max-width: 200px;
      line-height: 1.6;
    }

    .warning.visible {
      opacity: 1;
    }

    /* Particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 50;
    }

    .particle {
      position: absolute;
      width: 1px;
      height: 1px;
      background: white;
      border-radius: 50%;
      opacity: 0.2;
    }

    /* Glitch effects */
    .glitch-text {
      animation: textGlitch 0.1s infinite;
    }

    @keyframes textGlitch {
      0% { opacity: 1; }
      50% { opacity: 0.8; }
      100% { opacity: 1; }
    }

    .screen-tear {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: rgba(255, 255, 255, 0.1);
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
    }

    .screen-tear.active {
      animation: tear 0.15s ease-out;
    }

    @keyframes tear {
      0% { opacity: 1; top: 0; }
      100% { opacity: 0; top: 100%; }
    }
  </style>
</head>
<body>
  <div class="tunnel-container" id="tunnel">
    <!-- Layer 0: Surface -->
    <div class="layer" data-depth="0">
      <div class="layer-content">
        <h2 id="title-0">Surface</h2>
        <p id="text-0">You stand at the edge. Below lies depth, meaning, and something else entirely. Scroll to begin your descent.</p>
        <p class="detail" id="detail-0">The beginning is always the same.</p>
      </div>
    </div>

    <!-- Layer 1 -->
    <div class="layer" data-depth="1">
      <div class="layer-content">
        <h2 id="title-1">Shallow Waters</h2>
        <p id="text-1">The first layer feels familiar. Safe. Light still reaches here. You can still see the surface if you look up.</p>
        <p class="detail" id="detail-1">Most people turn back here.</p>
      </div>
    </div>

    <!-- Layer 2 -->
    <div class="layer" data-depth="2">
      <div class="layer-content">
        <h2 id="title-2">The Twilight Zone</h2>
        <p id="text-2">Light fades. The familiar grows distant. Down here, shapes shift in the periphery. Don't look directly at them.</p>
        <p class="detail" id="detail-2">Was this text always here?</p>
      </div>
    </div>

    <!-- Layer 3 -->
    <div class="layer" data-depth="3">
      <div class="layer-content">
        <h2 id="title-3">The Midnight Zone</h2>
        <p id="text-3">Absolute darkness. Yet you see. Somehow. The pressure is immense but you've adapted. You're not the same person who started this descent.</p>
        <p class="detail" id="detail-3">Check the surface. Something changed.</p>
      </div>
    </div>

    <!-- Layer 4 -->
    <div class="layer" data-depth="4">
      <div class="layer-content">
        <h2 id="title-4">The Abyss</h2>
        <p id="text-4">Few reach this depth. Fewer return unchanged. The abyss doesn't just gaze backâ€”it remembers you. Every visit.</p>
        <p class="detail" id="detail-4">You've been here before.</p>
      </div>
    </div>

    <!-- Layer 5 -->
    <div class="layer" data-depth="5">
      <div class="layer-content">
        <h2 id="title-5">The Hadal Zone</h2>
        <p id="text-5">Named for Hades. God of the underworld. This is where forgotten things live. Where lost memories pool. Where you left something, once.</p>
        <p class="detail" id="detail-5">Do you remember what?</p>
      </div>
    </div>

    <!-- Layer 6: The Core -->
    <div class="layer" data-depth="6">
      <div class="layer-content">
        <h2 id="title-6">The Core</h2>
        <p id="text-6">You found it. Or it found you. There's no difference at this depth. You can scroll back up now. Everything will be exactly as you left it.</p>
        <p class="detail" id="detail-6">Probably.</p>
      </div>
    </div>
  </div>

  <div class="depth-indicator" id="depthIndicator"></div>
  <div class="scroll-hint" id="scrollHint">Scroll to descend</div>
  <div class="vignette"></div>
  <div class="visit-indicator" id="visitIndicator"></div>
  <div class="warning" id="warning"></div>
  <div class="particles" id="particles"></div>
  <div class="screen-tear" id="screenTear"></div>

  <script>
    // ========== COMBINED SYSTEM ==========
    const app = {
      // State
      visits: parseInt(localStorage.getItem('descent_visits') || '0'),
      changes: JSON.parse(localStorage.getItem('descent_changes') || '{}'),
      deepestReached: parseInt(localStorage.getItem('descent_deepest') || '0'),
      visitedLayers: JSON.parse(localStorage.getItem('descent_visited') || '[]'),

      // Navigation state
      currentDepth: 0,
      targetDepth: 0,
      totalLayers: 7,
      layerSpacing: 900,

      // Content variations (gaslighting)
      variations: {
        'title-0': ['Surface', 'The Surface', 'Beginning', 'Start', 'Surface?', 'S u r f a c e'],
        'title-1': ['Shallow Waters', 'Shallow Water', 'The Shallows', 'Upper Waters', 'Still Shallow'],
        'title-2': ['The Twilight Zone', 'Twilight Zone', 'Twilight', 'The Fading', 'Between'],
        'title-3': ['The Midnight Zone', 'Midnight', 'Darkness', 'The Dark', 'Midnight Zone'],
        'title-4': ['The Abyss', 'Abyss', 'The Deep', 'Abyssal', 'The Void'],
        'title-5': ['The Hadal Zone', 'Hadal', 'Hades', 'The Forgotten', 'Below'],
        'title-6': ['The Core', 'Core', 'The End', 'The Center', 'It', '???'],

        'detail-0': ['The beginning is always the same.', 'Every journey starts here.', 'This never changes.', 'Or does it?', 'Check again.'],
        'detail-2': ['Was this text always here?', 'Did you notice the change?', 'Look at the title above.', 'Something shifted.', 'Pay attention.'],
        'detail-3': ['Check the surface. Something changed.', 'Go back up. See for yourself.', 'The surface remembers differently.', 'You remember wrong.', 'Or do you?'],
        'detail-4': ['You\'ve been here before.', 'We remember you.', 'Visit #' + (parseInt(localStorage.getItem('descent_visits') || '0') + 1), 'You always come back.', 'Welcome back.'],
        'detail-6': ['Probably.', 'Almost certainly.', 'Maybe.', 'Who knows?', 'Nothing changed.', 'Everything changed.'],

        warnings: [
          '',
          '',
          'Did the colors shift?',
          'Something is different. Can you tell what?',
          'The text on Layer 2 changed.',
          'Check the navigation dots. Count them.',
          'You\'ve been here many times.',
          'The titles are changing.',
          'This message wasn\'t here before.',
          'Go back to the surface. Read it again.',
          'Memory is unreliable.',
          'Trust nothing.',
          'Even this warning changes.'
        ]
      },

      init() {
        this.visits++;
        localStorage.setItem('descent_visits', this.visits);

        // Setup
        this.createDepthIndicator();
        this.createParticles();
        this.setupEventListeners();
        this.showVisitIndicator();

        // Apply gaslighting changes
        this.applyChanges();

        // Make new changes based on behavior
        if (this.visits > 1) {
          this.makeSubtleChanges();
        }

        // Show warning messages for returning visitors
        this.showWarning();

        // Start animation loop
        this.animate();

        // Console messages
        this.consoleMessages();
      },

      createDepthIndicator() {
        const indicator = document.getElementById('depthIndicator');
        for (let i = 0; i < this.totalLayers; i++) {
          const dot = document.createElement('div');
          dot.className = 'depth-dot' + (i === 0 ? ' active' : '');
          if (this.visitedLayers.includes(i)) dot.classList.add('visited');
          dot.addEventListener('click', () => { this.targetDepth = i; });
          indicator.appendChild(dot);
        }
      },

      createParticles() {
        const container = document.getElementById('particles');
        for (let i = 0; i < 40; i++) {
          const particle = document.createElement('div');
          particle.className = 'particle';
          particle.style.left = Math.random() * 100 + '%';
          particle.style.top = Math.random() * 100 + '%';
          container.appendChild(particle);
        }
      },

      setupEventListeners() {
        // Scroll
        window.addEventListener('wheel', (e) => {
          e.preventDefault();
          const delta = e.deltaY > 0 ? 0.12 : -0.12;
          this.targetDepth = Math.max(0, Math.min(this.totalLayers - 1, this.targetDepth + delta));
        }, { passive: false });

        // Touch
        let touchStartY = 0;
        window.addEventListener('touchstart', (e) => { touchStartY = e.touches[0].clientY; });
        window.addEventListener('touchmove', (e) => {
          e.preventDefault();
          const delta = (touchStartY - e.touches[0].clientY) * 0.003;
          this.targetDepth = Math.max(0, Math.min(this.totalLayers - 1, this.targetDepth + delta));
          touchStartY = e.touches[0].clientY;
        }, { passive: false });

        // Keyboard
        window.addEventListener('keydown', (e) => {
          if (e.key === 'ArrowDown' || e.key === ' ') {
            e.preventDefault();
            this.targetDepth = Math.min(this.totalLayers - 1, Math.round(this.targetDepth) + 1);
          } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            this.targetDepth = Math.max(0, Math.round(this.targetDepth) - 1);
          }
        });
      },

      showVisitIndicator() {
        const indicator = document.getElementById('visitIndicator');
        if (this.visits === 1) {
          indicator.textContent = 'First descent';
        } else {
          // Sometimes lie
          let displayVisits = this.visits;
          if (this.visits > 4 && Math.random() < 0.25) {
            displayVisits += Math.random() < 0.5 ? -1 : 1;
          }
          indicator.textContent = `Descent #${displayVisits}`;
        }
      },

      applyChanges() {
        Object.keys(this.changes).forEach(elementId => {
          const element = document.getElementById(elementId);
          if (element && this.variations[elementId]) {
            const variantIndex = this.changes[elementId];
            if (this.variations[elementId][variantIndex]) {
              element.textContent = this.variations[elementId][variantIndex];
            }
          }
        });
      },

      makeSubtleChanges() {
        // Progressive changes based on visit count
        const changeChance = Math.min(0.6, 0.2 + (this.visits * 0.05));

        if (Math.random() < changeChance) {
          const changeableElements = Object.keys(this.variations).filter(k => !k.includes('warning'));
          const elementToChange = changeableElements[Math.floor(Math.random() * changeableElements.length)];

          const currentIndex = this.changes[elementToChange] || 0;
          const maxIndex = this.variations[elementToChange].length - 1;
          const newIndex = Math.min(currentIndex + 1, maxIndex);

          this.changes[elementToChange] = newIndex;
          localStorage.setItem('descent_changes', JSON.stringify(this.changes));

          // Apply immediately
          const element = document.getElementById(elementToChange);
          if (element) {
            element.textContent = this.variations[elementToChange][newIndex];
          }
        }

        // After many visits, add glitch effects
        if (this.visits > 6) {
          setInterval(() => {
            if (Math.random() < 0.03) {
              this.triggerGlitch();
            }
          }, 3000);
        }
      },

      showWarning() {
        if (this.visits < 3) return;

        const warningEl = document.getElementById('warning');
        const warningIndex = Math.min(this.visits - 2, this.variations.warnings.length - 1);
        const warning = this.variations.warnings[warningIndex];

        if (warning) {
          setTimeout(() => {
            warningEl.textContent = warning;
            warningEl.classList.add('visible');
          }, 4000);
        }
      },

      triggerGlitch() {
        // Screen tear
        const tear = document.getElementById('screenTear');
        tear.classList.add('active');
        setTimeout(() => tear.classList.remove('active'), 150);

        // Random text glitch
        const elements = document.querySelectorAll('h2, p');
        const randomEl = elements[Math.floor(Math.random() * elements.length)];
        randomEl.classList.add('glitch-text');
        setTimeout(() => randomEl.classList.remove('glitch-text'), 100);
      },

      updateLayers() {
        const layers = document.querySelectorAll('.layer');

        layers.forEach((layer, i) => {
          const z = (i - this.currentDepth) * this.layerSpacing;
          const scale = Math.max(0.1, 1 - Math.abs(i - this.currentDepth) * 0.08);
          const size = 110 + (i * 40);

          layer.style.width = size + 'vmin';
          layer.style.height = size + 'vmin';
          layer.style.marginLeft = -size / 2 + 'vmin';
          layer.style.marginTop = -size / 2 + 'vmin';
          layer.style.transform = `translateZ(${-z}px) scale(${scale})`;

          const distance = Math.abs(i - this.currentDepth);
          layer.classList.toggle('active', distance < 0.5);
          layer.style.opacity = Math.max(0, 1 - distance * 0.25);
        });

        // Update depth dots
        document.querySelectorAll('.depth-dot').forEach((dot, i) => {
          dot.classList.toggle('active', Math.round(this.currentDepth) === i);
        });

        // Track deepest reached
        const currentLayer = Math.round(this.currentDepth);
        if (currentLayer > this.deepestReached) {
          this.deepestReached = currentLayer;
          localStorage.setItem('descent_deepest', this.deepestReached);
        }

        // Track visited layers
        if (!this.visitedLayers.includes(currentLayer)) {
          this.visitedLayers.push(currentLayer);
          localStorage.setItem('descent_visited', JSON.stringify(this.visitedLayers));
          document.querySelectorAll('.depth-dot')[currentLayer]?.classList.add('visited');
        }

        // Hide scroll hint after first scroll
        if (this.currentDepth > 0.3) {
          document.getElementById('scrollHint').classList.add('hidden');
        }
      },

      animate() {
        this.currentDepth += (this.targetDepth - this.currentDepth) * 0.06;
        this.updateLayers();

        // Animate particles based on movement
        const particles = document.querySelectorAll('.particle');
        const direction = this.targetDepth > this.currentDepth ? 1 : -1;
        particles.forEach((p, i) => {
          const speed = ((i % 4) + 1) * 0.3;
          let top = parseFloat(p.style.top) || Math.random() * 100;
          top += speed * direction * 0.05;
          if (top > 100) top = 0;
          if (top < 0) top = 100;
          p.style.top = top + '%';
        });

        requestAnimationFrame(() => this.animate());
      },

      consoleMessages() {
        console.log('%cDESCENT', 'font-size: 20px; color: #666; font-family: Georgia;');
        console.log('%cVisit #' + this.visits, 'color: #888;');
        if (this.visits > 3) {
          console.log('%cSomething has changed since your last visit.', 'color: #664444;');
        }
        if (this.visits > 7) {
          console.log('%cCan you tell what?', 'color: #664444;');
        }

        // Hidden reset
        window.resetDescent = () => {
          localStorage.removeItem('descent_visits');
          localStorage.removeItem('descent_changes');
          localStorage.removeItem('descent_deepest');
          localStorage.removeItem('descent_visited');
          location.reload();
        };
      }
    };

    // Start
    app.init();
  </script>
</body>
</html>
